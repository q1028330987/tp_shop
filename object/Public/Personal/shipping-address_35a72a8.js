$(function(){function e(e){return null==e?"":e.replace(/\s+/g,"").replace(/[\r\n]/g,"")}VIVO_UI.HighLightMyCenterNav("收货地址");var n=new Region({container:$("#j_ReginContriner")}),t=$(".content .edit-box"),d="slow",i={addressSubmitButton:function(){$(this).is(":disabled")?$(this).addClass("btn-blue").removeAttr("disabled"):$(this).removeClass("btn-blue").attr("disabled","disabled")},dialog:function(e,n,t,d,i){new Dialog({title:e,content:n,icon:t,confirmBtn:!0,cancelBtn:d,confirmCallback:i})},refreshPage:function(){window.location.reload()},formDataReset:function(){$("form").find("input[name='id']").val(null),$("form").find("input[name='defaultAddr']").parent().removeAttr("style"),$("form").find(".area-select").removeAttr("style").attr("style","display: none"),$("form").find(".city-select").removeAttr("style").attr("style","display: none")}},a={init:function(){$(".content .module-title .add").next().click(function(){$("#shipping-address-new-edit")[0].reset(),i.formDataReset(),t.slideDown(d)});var e=$(".content input[type=reset]");e.click(function(){a.removeErrorMsg(),t.slideUp(d)})},removeErrorMsg:function(){var e=$("span.error-style");e.size()>0&&e.each(function(){$(this).remove()})},initEvent:function(){var e=this;e.addressDeleteConfirm(),e.addressEdit(),e.addressSubmit(),e.checkBoxChange(),e.addressDefault()},addressEdit:function(){$("body").on("click",".address-edit",function(){a.removeErrorMsg();var e=$(this).attr("addressId"),t=$(this).parents(".address-info"),d=t.find("span[name='address.receiverName']").text(),i=t.find("span[name='address.province']").text(),r=t.find("span[name='address.city']").text(),s=t.find("span[name='address.area']").text(),o=t.find("span[name='address.address']").text(),l=t.find("span[name='address.mobilePhone']").text(),c=t.find("span[name='address.telPhone']").text(),u=t.find("span[name='address.zipCode']").text(),f=t.find(".select-address").attr("defaultAddr"),m=$("form");m.find("input[name='receiverName']").val(d),m.find("input[name='address']").val(o),m.find("input[name='mobilePhone']").val(l),m.find("input[name='telPhone']").val(c),m.find("input[name='zipCode']").val(u),m.find("input[name='id']").val(e),m.find("input[name='defaultAddr']").prop("checked",1==f?!0:!1),m.find("input[name='defaultAddr']").val(f),m.find("input[name='defaultAddr']").parent().hide(),$(".content .edit-box").slideDown("slow"),n.setValue([i,r,s])})},addressDeleteConfirm:function(){$("body").on("click",".address-delete",function(){var e=this;i.dialog("删除确认","确认要删除此收货地址？","warning",!0,function(){var n=$(e).siblings(".address-edit").attr("addressId");$.ajax({url:webCtx+"/userAddress/del",type:"POST",data:{id:n},success:function(e){200==e.retCode?i.dialog("成功","删除成功！","success",null,i.refreshPage):i.dialog("失败",e.retMsg,"warning")},error:function(){i.dialog("失败","系统繁忙，请稍后重试！","warning")}})})})},addressDefault:function(){$("body").on("click",".default-address-false",function(){var e=$(this).siblings(".address-edit").attr("addressId");$.ajax({url:webCtx+"/userAddress/setDefault",type:"POST",data:{id:e},success:function(e){200==e.retCode?i.dialog("成功","操作成功！","success",null,i.refreshPage):i.dialog("失败","系统繁忙，请稍后重试！","warning")},error:function(){i.dialog("失败","系统繁忙，请稍后重试！","warning")}})})},checkBoxChange:function(){$("form").on("change","input[name='defaultAddr']",function(){$(this).val($(this).prop("checked")?1:0)})},addressSubmit:function(){$("#shipping-address-new-edit").on("click",".confirm-btn",function(){var n=this;return r.form()?(i.addressSubmitButton.call(this),void $.ajax({url:webCtx+"/userAddress/newOrEdit",type:"POST",data:{id:$("#id").val(),receiverName:e($("#receiverName").val()),mobilePhone:e($("#mobilePhone").val()),telPhone:e($("#telPhone").val()),province:e($("#province").val()),city:e($("#city").val()),area:e($("#area").val()),address:e($("#address").val()),defaultAddr:$("#default").val()},success:function(e){i.addressSubmitButton.call(n),200==e.retCode?(new Dialog({title:"",content:"操作成功,请稍等...",icon:"success"}),setTimeout(function(){window.location.reload()},5e3)):430==e.retCode?i.dialog("失败",e.retMsg,"warning"):i.dialog("失败",e.retMsg,"warning")},error:function(){i.dialog("失败","系统繁忙，请稍后重试！","warning"),i.addressSubmitButton.call(n)}})):void r.focusInvalid()})}};$.validator.addMethod("address",function(e,n){return this.optional(n)||"_NULL_"!=e}),$.validator.addMethod("isMobile",function(e,n){var t=e.length,d=/^(13[0-9]{9})|(18[0-9]{9})|(14[0-9]{9})|(17[0-9]{9})|(15[0-9]{9})$/;return this.optional(n)||11==t&&d.test(e)},"请正确填写手机号码！"),$.validator.addMethod("isTelPhone",function(e,n){var t=/^\d{3,4}-?\d{7,9}$/;return this.optional(n)||t.test(e)},"请填写正确的电话号码！"),$.validator.addMethod("isZipCode",function(e,n){var t=/^[0-9]{6}$/;return this.optional(n)||t.test(e)},"请填写正确的邮政编码！"),$.validator.addMethod("address_detail",function(e,n){e=$.trim(e),$("#address").val(e);var t=e.length;return this.optional(n)||50>=t}),$.validator.addMethod("receive_name",function(e,n){e=$.trim(e),$("#receiverName").val(e);var t=e.length;return this.optional(n)||20>=t});var r=$("#shipping-address-new-edit").validate({debug:!0,errorElement:"span",errorClass:"error-style",focusInvalid:!1,rules:{province:{address:!0},city:{address:!0},area:{address:!0},address:{required:!0,address_detail:!0},receiverName:{required:!0,receive_name:!0},mobilePhone:{required:!0,isMobile:!0},telPhone:{isTelPhone:!0},zipCode:{number:!0,isZipCode:!0}},messages:{province:{address:"请选择省份！"},city:{address:"请选择市区！"},area:{address:"请选择区域！"},address:{required:"请填写详细地址！",address_detail:"详细地址小于50个字符！"},receiverName:{required:"请填写收件人姓名！",receive_name:"姓名小于20个字符！"},mobilePhone:{required:"请输入手机号码！",isMobile:"请正确填写手机号码！"},telPhone:{isTelPhone:"请填写正确的电话号码！"},zipCode:{number:"必须为数字!",isZipCode:"请填写正确的邮政编码！"}}});a.init(),a.initEvent()});